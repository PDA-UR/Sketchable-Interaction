<h1 id="pysi-api">PySI API</h1>
<h2 id="introduction">Introduction</h2>
<p>The PySI API facilitates its users to build new SI-Plugins from scratch or extend and modify existing ones. An SI-Plugin is an implementation of an <em>effect</em> of an <em>interactive region</em> (early concept: <a href="#refs">[1]</a>). Such an <em>effect</em> is triggered once end-users overlap two <em>interactive regions</em>, defining a <em>collision</em>. Additionally, <em>interactive regions</em> can be <em>linked</em>. Such <em>linking relationships</em> are defined according to <em>attributes</em>. Application developers specify in the implementation of an <em>effect</em> which <em>attributes</em> of that <em>effect</em> can be linked to which <em>attributes</em> of other <em>effects</em> and which <em>linking action</em> shall occur. Standard <em>attributes</em> are either provided by the PySI API, such as <em>position</em>, or may be created as ad-hoc identifiers which are chosen by application developers.</p>
<p>The PySI API aims to streamline the implementation of an SI-Plugin in partially descriptive, partially imperative and self-documenting fashion. This document’s goal is to describe the PySI API beyond its code documentation. Therefore, the next sections describe PySI, its API and use case examples.</p>
<p>If you are just starting out with developing SI-Plugins it may be useful to play around with the PySI API first to get a feel for it. For that, skip ahead to the section <span style="color:blue"><a href="#impl_tag">Example: Implementation of a Tag-Effect</a></span>. The more detailed aspects of PySI and its API are present in the other chapters and may be consulted as required. This document applies the best practices proposed by RFC2119 (keywords <strong>must</strong>, <strong>should</strong>, <strong>may</strong>)<a href="#refs">[2]</a>.</p>
<h2 id="description">Description</h2>
<h3 id="api-integration-in-sigrun">API Integration in SIGRun</h3>
<p>PySI exposes bindings to C++ datastructures and functions. These bindings are built with the use of Boost.Python <a href="#refs">[3]</a> Each plugin file is stored in an <em>object</em> within SIGRun. This <em>object</em> functionally represents the pythonic <em>self</em> in SIGrun. Therefore, the python code implemented in the functions of SI-Plugins is executed by SIGRun once end-users trigger their events and actions. In this way, API users build application logic purely in python (with the use of python libraries available to them), while SIGRun provides the <em>glue</em> to present those applications to end-users.</p>
<h3 id="pysi-obscurities">PySI obscurities</h3>
<ul>
<li>shape and its size</li>
</ul>
<h3 id="the-startup-file">The Startup File</h3>
<h4 id="goal">Goal</h4>
<p>API users configure the startup sequence of SIGRun</p>
<ul>
<li>API users <strong>must</strong> provide a startup file in the <em>plugins</em> folder</li>
<li>API users <strong>may</strong> spawn <em>interactive regions</em></li>
<li>API users <strong>may</strong> configure logging behaviour</li>
</ul>
<h4 id="naming-convention">Naming Convention</h4>
<p>Startup python file <strong>must</strong> be named <em>StartSIGRun.py</em></p>
<h4 id="structure">Structure</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">from</span> libPySI <span class="im">import</span> PySI</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># further imports as you see fit such as plugin files for using their static </span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co"># members or auxiliary non-plugin python3 files</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># other variables or functions</span></a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">def</span> on_start():</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="co"># configuration logic **must** be written here</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="cf">pass</span></a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># other variables or functions</span></a></code></pre></div>
<p>Summary:</p>
<ul>
<li><em>StartSIGRun.py</em> <strong>must</strong> import libPySI</li>
<li><em>StartSIGRun.py</em> <strong>must</strong> include a module-level function called <em>on_start()</em></li>
<li><em>on_start</em> <strong>must</strong> contain all configuration logic</li>
<li><em>on_start()</em> <strong>must not</strong> have any arguments</li>
<li>API Users <strong>should</strong> create additional functions and variables on module level</li>
</ul>
<h3 id="the-plugin-file">The Plugin File</h3>
<h4 id="goal-1">Goal</h4>
<ul>
<li>API Users implement <em>effects</em> for <em>interactive regions</em></li>
<li>API Users <strong>must</strong> specify collision capabilities (str-value) and callback functions for <em>collision event</em> emissions and receptions
<ul>
<li>on_enter - triggered exactly once when first time collision of <em>interactive regions</em> is detected</li>
<li>on_continuous - triggered in each subsequent SIGRun update when collision remains ongoing</li>
<li>on_leave - triggered exactly once when a previously ongoing collision is detected to have stopped</li>
</ul></li>
<li>API Users <strong>must</strong> specify linking relationships according to attributes (str-values) and linking actions (functions)</li>
</ul>
<h4 id="naming-convention-1">Naming Convention</h4>
<ul>
<li>plugin files <strong>must</strong> contain exactly one class</li>
<li>names of plugin files <strong>must</strong> be the exact same name as the classes they implement</li>
<li>example: Tag.py contains a class called Tag</li>
</ul>
<h4 id="structure-1">Structure</h4>
<p>MyEffect.py</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="im">from</span> libPySI <span class="im">import</span> PySI</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="im">from</span> plugins.standard_environment_library.SIEffect <span class="im">import</span> SIEffect</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co"># same name as python file </span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># it is highly recommended to inherit from SIEffect for ease of use</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw">class</span> MyEffect(SIEffect):</a>
<a class="sourceLine" id="cb2-7" title="7">    regiontype <span class="op">=</span> PySI.EffectType.SI_CUSTOM</a>
<a class="sourceLine" id="cb2-8" title="8">    regionname <span class="op">=</span> PySI.EffectName.SI_STD_NAME_CUSTOM  <span class="co"># name used only internally</span></a>
<a class="sourceLine" id="cb2-9" title="9">    region_display_name <span class="op">=</span> <span class="st">&quot;MyEffect&quot;</span>  <span class="co"># name to be shown to end-users</span></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, shape<span class="op">=</span>PySI.PointVector(), uuid<span class="op">=</span><span class="st">&quot;&quot;</span>, kwargs<span class="op">=</span>{}):</a>
<a class="sourceLine" id="cb2-12" title="12">        <span class="bu">super</span>(MyEffect, <span class="va">self</span>).<span class="fu">__init__</span>(shape, uuid, <span class="st">&quot;res/my_effect.png&quot;</span>,</a>
<a class="sourceLine" id="cb2-13" title="13">                                       Button.regiontype, Button.regionname,</a>
<a class="sourceLine" id="cb2-14" title="14">                                       kwargs)</a>
<a class="sourceLine" id="cb2-15" title="15">        </a>
<a class="sourceLine" id="cb2-16" title="16">        <span class="va">self</span>.qml_path <span class="op">=</span> <span class="st">&quot;path/to/MyEffect.qml&quot;</span></a>
<a class="sourceLine" id="cb2-17" title="17">    </a>
<a class="sourceLine" id="cb2-18" title="18">        <span class="co"># further member variables</span></a>
<a class="sourceLine" id="cb2-19" title="19"></a>
<a class="sourceLine" id="cb2-20" title="20">    <span class="co"># further member functions  </span></a></code></pre></div>
<p>Summary:</p>
<ul>
<li>plugin files <strong>must</strong> import libPySI</li>
<li>plugin files <strong>must</strong> use static member variables <em>regiontye</em>, <em>regionname</em>, and region_display_name</li>
<li><em>regiontye</em> and <em>regionname</em> <strong>must</strong> be intialized according to PySI effect types and effect names respectively (if unsure use above example initialization)</li>
<li><em>init</em>’s signature <strong>must</strong> look exactly as the example above</li>
<li><em>self.qml_path</em> <strong>must</strong> be left empty if no QML file is required to accompany the plugin</li>
<li><em>region_display_name</em> <strong>should not</strong> be an empty str</li>
<li>plugin files <strong>should</strong> import SIEffect for ease of use</li>
<li><em>init</em>’s default parameters <strong>may</strong> be changed</li>
</ul>
<h4 id="enabling-and-disabling-of-effects-and-linking-relationships">Enabling and Disabling of Effects and Linking Relationships</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">from</span> libPySI <span class="im">import</span> PySI</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">from</span> plugins.standard_environment_library.SIEffect <span class="im">import</span> SIEffect</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">class</span> MyEffect(SIEffect):</a>
<a class="sourceLine" id="cb3-5" title="5">    regiontype <span class="op">=</span> PySI.EffectType.SI_CUSTOM</a>
<a class="sourceLine" id="cb3-6" title="6">    regionname <span class="op">=</span> PySI.EffectName.SI_STD_NAME_CUSTOM</a>
<a class="sourceLine" id="cb3-7" title="7">    region_display_name <span class="op">=</span> <span class="st">&quot;MyEffect&quot;</span></a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, shape<span class="op">=</span>PySI.PointVector(), uuid<span class="op">=</span><span class="st">&quot;&quot;</span>, kwargs<span class="op">=</span>{}):</a>
<a class="sourceLine" id="cb3-10" title="10">        <span class="bu">super</span>(MyEffect, <span class="va">self</span>).<span class="fu">__init__</span>(shape, uuid, <span class="st">&quot;res/my_effect.png&quot;</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">                                       Button.regiontype, Button.regionname,</a>
<a class="sourceLine" id="cb3-12" title="12">                                       kwargs)</a>
<a class="sourceLine" id="cb3-13" title="13">        </a>
<a class="sourceLine" id="cb3-14" title="14">        <span class="va">self</span>.qml_path <span class="op">=</span> <span class="st">&quot;path/to/MyEffect.qml&quot;</span></a>
<a class="sourceLine" id="cb3-15" title="15">    </a>
<a class="sourceLine" id="cb3-16" title="16">        <span class="co"># enable an effect, according to a capability (str-value), to be emitted</span></a>
<a class="sourceLine" id="cb3-17" title="17">        <span class="co"># according to the collision event functions</span></a>
<a class="sourceLine" id="cb3-18" title="18"></a>
<a class="sourceLine" id="cb3-19" title="19">        <span class="co"># collison_event_on_enter_emit must be a function </span></a>
<a class="sourceLine" id="cb3-20" title="20">        <span class="co"># (e.g. self.on_collision_event_enter_emit) as parameter </span></a>
<a class="sourceLine" id="cb3-21" title="21">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-22" title="22"></a>
<a class="sourceLine" id="cb3-23" title="23">        <span class="co"># collison_event_on_continuous_emit must be a function </span></a>
<a class="sourceLine" id="cb3-24" title="24">        <span class="co"># (e.g. self.on_collision_event_continuous_emit) as parameter </span></a>
<a class="sourceLine" id="cb3-25" title="25">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-26" title="26"></a>
<a class="sourceLine" id="cb3-27" title="27">        <span class="co"># collison_event_on_leave_emit must be a function </span></a>
<a class="sourceLine" id="cb3-28" title="28">        <span class="co"># (e.g. self.on_collision_event_leave_emit) as parameter </span></a>
<a class="sourceLine" id="cb3-29" title="29">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-30" title="30">        <span class="va">self</span>.enable_effect(<span class="st">&quot;your_capability&quot;</span>, SIEffect.EMISSION, </a>
<a class="sourceLine" id="cb3-31" title="31">                           <span class="op">&lt;</span>collison_event_on_enter_emit<span class="op">&gt;</span>, </a>
<a class="sourceLine" id="cb3-32" title="32">                           <span class="op">&lt;</span>collison_event_on_continuous_emit<span class="op">&gt;</span>, </a>
<a class="sourceLine" id="cb3-33" title="33">                           <span class="op">&lt;</span>collison_event_on_leave_emit<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb3-34" title="34">        </a>
<a class="sourceLine" id="cb3-35" title="35">        <span class="co"># enable an effect, according to a capability (str-value), </span></a>
<a class="sourceLine" id="cb3-36" title="36">        <span class="co"># to be received according to the collision event functions</span></a>
<a class="sourceLine" id="cb3-37" title="37"></a>
<a class="sourceLine" id="cb3-38" title="38">        <span class="co"># &quot;your_other_capability&quot; can be any str-value </span></a>
<a class="sourceLine" id="cb3-39" title="39">  </a>
<a class="sourceLine" id="cb3-40" title="40">        <span class="co"># collison_event_on_enter_recv must be a function </span></a>
<a class="sourceLine" id="cb3-41" title="41">        <span class="co"># (e.g. self.on_collision_event_enter_recv) as parameter </span></a>
<a class="sourceLine" id="cb3-42" title="42">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-43" title="43"></a>
<a class="sourceLine" id="cb3-44" title="44">        <span class="co"># collison_event_on_continuous_recv must be a function </span></a>
<a class="sourceLine" id="cb3-45" title="45">        <span class="co"># (e.g. self.on_collision_event_continuous_recv) as parameter </span></a>
<a class="sourceLine" id="cb3-46" title="46">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-47" title="47"></a>
<a class="sourceLine" id="cb3-48" title="48">        <span class="co"># collison_event_on_leave_recv must be a function</span></a>
<a class="sourceLine" id="cb3-49" title="49">        <span class="co"># (e.g. self.on_collision_event_leave_recv) as parameter</span></a>
<a class="sourceLine" id="cb3-50" title="50">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-51" title="51">        <span class="va">self</span>.enable_effect(<span class="st">&quot;your_other_capability&quot;</span>, SIEffect.RECEPTION, </a>
<a class="sourceLine" id="cb3-52" title="52">                           <span class="op">&lt;</span>collison_event_on_enter_recv<span class="op">&gt;</span>, </a>
<a class="sourceLine" id="cb3-53" title="53">                           <span class="op">&lt;</span>collison_event_on_continuous_recv<span class="op">&gt;</span>, </a>
<a class="sourceLine" id="cb3-54" title="54">                           <span class="op">&lt;</span>collison_event_on_leave_recv<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb3-55" title="55">      </a>
<a class="sourceLine" id="cb3-56" title="56">        <span class="co"># disable an effect, according to a collision capability (str-value), </span></a>
<a class="sourceLine" id="cb3-57" title="57">        <span class="co"># so the effect stops being emitted</span></a>
<a class="sourceLine" id="cb3-58" title="58"></a>
<a class="sourceLine" id="cb3-59" title="59">        <span class="co"># &quot;your_capability&quot; can be any str-value </span></a>
<a class="sourceLine" id="cb3-60" title="60">        <span class="va">self</span>.disable_effect(<span class="st">&quot;your_capability&quot;</span>, SIEffect.EMISSION)</a>
<a class="sourceLine" id="cb3-61" title="61"></a>
<a class="sourceLine" id="cb3-62" title="62">        <span class="co"># disable an effect, according to a collision capability (str-value),</span></a>
<a class="sourceLine" id="cb3-63" title="63">        <span class="co"># so the effect stops being received</span></a>
<a class="sourceLine" id="cb3-64" title="64"></a>
<a class="sourceLine" id="cb3-65" title="65">        <span class="co"># &quot;your_other_capability&quot; can be any str-value  </span></a>
<a class="sourceLine" id="cb3-66" title="66">        <span class="va">self</span>.disable_effect(<span class="st">&quot;your_other_capability&quot;</span>, SIEffect.RECEPTION)</a>
<a class="sourceLine" id="cb3-67" title="67">        </a>
<a class="sourceLine" id="cb3-68" title="68">        <span class="co"># enable a link, according to an attribute (str-value), so that the </span></a>
<a class="sourceLine" id="cb3-69" title="69">        <span class="co"># effect emits the given linking action (function)</span></a>
<a class="sourceLine" id="cb3-70" title="70"></a>
<a class="sourceLine" id="cb3-71" title="71">        <span class="co"># &quot;your_attribute&quot; may be any str-value</span></a>
<a class="sourceLine" id="cb3-72" title="72"></a>
<a class="sourceLine" id="cb3-73" title="73">        <span class="co"># &lt;linking_action_for_emission&gt; must be a function </span></a>
<a class="sourceLine" id="cb3-74" title="74">        <span class="co"># (e.g. self.linking_action) as parameter</span></a>
<a class="sourceLine" id="cb3-75" title="75">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-76" title="76">        <span class="va">self</span>.enable_link_emission(<span class="st">&quot;your_attribute&quot;</span>, </a>
<a class="sourceLine" id="cb3-77" title="77">                                  <span class="op">&lt;</span>linking_action_for_emission<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb3-78" title="78">        </a>
<a class="sourceLine" id="cb3-79" title="79">        <span class="co"># enable a link, according to a source attribute (str-value) and target </span></a>
<a class="sourceLine" id="cb3-80" title="80">        <span class="co"># attribute, so that the effect receives a linking action according to </span></a>
<a class="sourceLine" id="cb3-81" title="81">        <span class="co"># the given function</span></a>
<a class="sourceLine" id="cb3-82" title="82"></a>
<a class="sourceLine" id="cb3-83" title="83">        <span class="co"># &quot;your_attribute&quot; can be any str-value</span></a>
<a class="sourceLine" id="cb3-84" title="84">        <span class="co"># &lt;linking_action_for_emission&gt; must be a function </span></a>
<a class="sourceLine" id="cb3-85" title="85">        <span class="co"># (e.g. self.linking_action) as parameter </span></a>
<a class="sourceLine" id="cb3-86" title="86">        <span class="co"># (must not not call the function in the parameter list)</span></a>
<a class="sourceLine" id="cb3-87" title="87">        <span class="va">self</span>.enable_link_reception(<span class="st">&quot;source_attribute&quot;</span>, <span class="st">&quot;your_attribute&quot;</span>, </a>
<a class="sourceLine" id="cb3-88" title="88">                                   <span class="op">&lt;</span>linking_action_for_reception<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb3-89" title="89">        </a>
<a class="sourceLine" id="cb3-90" title="90">        <span class="co"># disable a link, according to an attribute (str-value), so that the </span></a>
<a class="sourceLine" id="cb3-91" title="91">        <span class="co"># effect stops emitting that linking action  </span></a>
<a class="sourceLine" id="cb3-92" title="92">        <span class="va">self</span>.disable_link_emission(<span class="st">&quot;your_attribute&quot;</span>)</a>
<a class="sourceLine" id="cb3-93" title="93">    </a>
<a class="sourceLine" id="cb3-94" title="94">        <span class="co">#disable a link, according to a source_attribute and target attribute, </span></a>
<a class="sourceLine" id="cb3-95" title="95">        <span class="co"># so that the effect stops receiving that linking action</span></a>
<a class="sourceLine" id="cb3-96" title="96">        <span class="co"># specify &quot;your_attribute&quot; to selectively disable that exact linking </span></a>
<a class="sourceLine" id="cb3-97" title="97">        <span class="co"># relationship</span></a>
<a class="sourceLine" id="cb3-98" title="98">        <span class="co"># leave &quot;your_attribute&quot; empty (&quot;&quot;) to disable all linking relationships</span></a>
<a class="sourceLine" id="cb3-99" title="99">        <span class="co"># which are triggered by &quot;source_attribute&quot;</span></a>
<a class="sourceLine" id="cb3-100" title="100">        <span class="va">self</span>.disable_link_reception(<span class="st">&quot;source_attribute&quot;</span>, <span class="st">&quot;your_attribute&quot;</span>) </a></code></pre></div>
<p>Summary:</p>
<ul>
<li>API users <strong>must</strong> specify own names for capabilities and attributes if those are not part of PySI API</li>
<li>Emitting <em>collision event</em> functions <strong>must</strong> have one additional argument which is the receiving effect (e.g. def collison_event_on_enter_emit(self, other))</li>
<li>API users <strong>should</strong> use the functions enable_effect, disable_effect, enable_link_emission, disable_link_emission, enable_link_reception, disable_link_reception to register required <em>collision events</em> and <em>linking actions</em></li>
<li>API users <strong>should</strong> use PySI built-in capabilities and attributes if available e.g. PySI.CollisionCapability.DELETION (for collision with deletion region) or PySI.LinkingCapability.POSITION (for linking to position attribute)</li>
</ul>
<h3 id="the-qml-file">The QML File</h3>
<h4 id="goal-2">Goal</h4>
<ul>
<li>API Users <strong>must</strong> use qml-files to define which styling an <em>effect</em> applies to its associated <em>interactive regions</em> beyond flat coloring</li>
<li>QML-files and plugin-files <strong>should</strong> come in pairs</li>
<li>Plugin-files *+may** have no associated qml-file</li>
<li>QML<a href="#refs">[4]</a> facilitates styling and modifying the style of regions at runtime for API Users</li>
</ul>
<h4 id="naming-convention-2">Naming Convention</h4>
<ul>
<li>QML-files <strong>must</strong> have exactly the same name as their associated plugin-files except for their file endings</li>
<li>example: MyEffect.py and MyEffect.qml</li>
</ul>
<h4 id="structure-2">Structure</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1">Item</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="kw">function</span> <span class="at">updateData</span>(data)</a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="op">{</span></a>
<a class="sourceLine" id="cb4-5" title="5">        <span class="co">// apply data</span></a>
<a class="sourceLine" id="cb4-6" title="6">        <span class="co">// e.g. </span></a>
<a class="sourceLine" id="cb4-7" title="7">        <span class="co">// image.width = data.width;</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">id</span><span class="op">:</span> container</a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">visible</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb4-12" title="12">    </a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="co">// further QML components such as Item, Image, etc.</span></a>
<a class="sourceLine" id="cb4-14" title="14">    <span class="co">// .</span></a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="co">// .</span></a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="co">// .</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="op">}</span></a></code></pre></div>
<p>Summary:</p>
<ul>
<li>API Users <strong>must</strong> view the axis-aligned bounding box of a shape or contour of an <em>interactive region</em> as a container for QML components</li>
<li>API Users <strong>must</strong> conform to QML-Syntax</li>
<li>API Users <strong>must</strong> provide a function <em>updateData(data)</em> which takes exactly one argument</li>
<li>API Users <strong>must</strong> use the <em>updateData(data)</em>-function to update qml-file and styling at runtime</li>
<li>API Users <strong>should</strong> define one <em>Item</em> in the qml-file which contains all other qml-components</li>
<li>API Users <strong>may</strong> change the parameter <em>data</em> to another identifier of their choosing</li>
</ul>
<h4 id="data-application">Data Application</h4>
<p>Data originates from python calls in a SI-Plugin</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1"><span class="va">self</span>.set_QML_data(<span class="st">&quot;width&quot;</span>, <span class="dv">200</span>, PySI.DataType.INT)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="va">self</span>.set_QML_data(<span class="st">&quot;height&quot;</span>, <span class="dv">300</span>, PySI.DataType.INT)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="va">self</span>.set_QML_data(<span class="st">&quot;visible&quot;</span>, <span class="va">True</span>, PySI.DataType.BOOL)</a></code></pre></div>
<p>and then data is applied in QML for registering the styling changes</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1">Item</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="kw">function</span> <span class="at">updateData</span>(data)</a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="co">// update the width, height and visibility of the container with data </span></a>
<a class="sourceLine" id="cb6-6" title="6">        <span class="co">//    received from the associated plugin-file</span></a>
<a class="sourceLine" id="cb6-7" title="7">        <span class="co">// the key/value pairs of data-parameter are equal to the ones specified</span></a>
<a class="sourceLine" id="cb6-8" title="8">        <span class="co">//    in set_QML_data</span></a>
<a class="sourceLine" id="cb6-9" title="9">        <span class="va">container</span>.<span class="at">width</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">width</span><span class="op">;</span>  <span class="co">// container.width now has the value 200</span></a>
<a class="sourceLine" id="cb6-10" title="10">        <span class="va">container</span>.<span class="at">height</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">height</span><span class="op">;</span>  <span class="co">// container.height now has the value </span></a>
<a class="sourceLine" id="cb6-11" title="11">        <span class="co">//    300</span></a>
<a class="sourceLine" id="cb6-12" title="12">        <span class="va">container</span>.<span class="at">visible</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">visible</span><span class="op">;</span>  <span class="co">// container.visible now has the </span></a>
<a class="sourceLine" id="cb6-13" title="13">        <span class="co">//    value true</span></a>
<a class="sourceLine" id="cb6-14" title="14">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="dt">id</span><span class="op">:</span> container</a>
<a class="sourceLine" id="cb6-17" title="17">    <span class="dt">visible</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb6-18" title="18">    </a>
<a class="sourceLine" id="cb6-19" title="19">    <span class="co">// further QML components such as Item, Image, etc.</span></a>
<a class="sourceLine" id="cb6-20" title="20">    <span class="co">// .</span></a>
<a class="sourceLine" id="cb6-21" title="21">    <span class="co">// .</span></a>
<a class="sourceLine" id="cb6-22" title="22">    <span class="co">// .</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="op">}</span></a></code></pre></div>
<p>Summary:</p>
<ul>
<li><em>data</em>-parameter is of type JavaScript-Object</li>
<li>API Users <strong>must</strong> use the <em>updateData(data)</em>-function to update qml-file and styling at runtime</li>
<li>API Users <strong>must</strong> use common JavaScript for the <em>updateData(data)</em>-function</li>
<li>API USers <strong>must</strong> call the function <em>self.set_QML_data(key, value, datatype)</em> from within the python plugin to change data in the qml-file
<ul>
<li><em>key</em>-parameter directly translates to the key identifier in the JavaScript object <em>data</em> (example: self.set_QML_data(“width”, 100, PySI.DataType.INT) will result in data.width = 100)</li>
<li><em>value</em>-parameter depicts the value assigned to the perviously specified key of the <em>data</em>-object</li>
<li><em>datatype</em>-parameter is required by SIGRun to transfer the data changes to QML</li>
</ul></li>
<li>API Users <strong>must</strong> assign values of the <em>data</em>-object to qml-components pre-defined in the qml-file</li>
<li>API Users <strong>may</strong> use this procedure to update any qml-component which is supported by QML such as Image, Item, etc.</li>
</ul>
<h3 id="use-of-non-plugin-python-files">Use Of Non-Plugin Python Files</h3>
<h4 id="goal-3">Goal</h4>
<p>API Users <strong>may</strong> perform <em>code decomposition</em> by defining python files and classes which SIGRun <strong>must not</strong> treat as SI-Plugins</p>
<h4 id="naming-convention-3">Naming Convention</h4>
<ul>
<li>Classes in Non-Plugin Python Files <strong>must</strong> be named with two leading underscores (e.g. class __MyClass)</li>
<li>Non-Plugin Python Files <strong>may</strong> contain classes</li>
<li>API Users <strong>may</strong> name Non-Plugin Python Files as they chose</li>
</ul>
<h4 id="structure-3">Structure</h4>
<p>Non-Plugin Python File</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># module level functions</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co"># SIGRun scans for classes and ignores module level functions per default</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">def</span> do_job():</a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="cf">pass</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co"># static class for helper functions (e.g. for better definition of namespaces)</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co"># __ as name prefix prevents SIGRun to read it as a SI-Plugin</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="kw">class</span> __MyHelperFunctions:</a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="at">@staticmethod</span> </a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="kw">def</span> do_work():</a>
<a class="sourceLine" id="cb7-12" title="12">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="co">#function</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="co"># .</span></a>
<a class="sourceLine" id="cb7-16" title="16">    <span class="co"># .</span></a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="co"># .</span></a>
<a class="sourceLine" id="cb7-18" title="18"></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co"># class defining behaviour or serving as a complex datastructure for use in </span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co"># plugins</span></a>
<a class="sourceLine" id="cb7-21" title="21"></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co"># __ as name prefix prevents SIGRun to read it as a SI-Plugin</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="kw">class</span> __MyHelperDatastructure:</a>
<a class="sourceLine" id="cb7-24" title="24">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, args, kwargs):</a>
<a class="sourceLine" id="cb7-25" title="25">        <span class="co"># assignment </span></a>
<a class="sourceLine" id="cb7-26" title="26">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb7-27" title="27">    </a>
<a class="sourceLine" id="cb7-28" title="28">    <span class="co"># functions</span></a>
<a class="sourceLine" id="cb7-29" title="29">    <span class="co"># .</span></a>
<a class="sourceLine" id="cb7-30" title="30">    <span class="co"># .</span></a>
<a class="sourceLine" id="cb7-31" title="31">    <span class="co"># .</span></a></code></pre></div>
<p>Summary:</p>
<ul>
<li>Non-Plugin Python Files <strong>must not</strong> contain classes which names do not start with two leading underscores</li>
<li>API Users <strong>should</strong> use Non-Plugin Python files for decomposition purposes</li>
<li>Non-Plugin Python Files <strong>may</strong> have module level functions</li>
<li>Non-Plugin Python Files <strong>may</strong> have classes</li>
</ul>
<h3 id="pysi-internal-bindings-to-c-datastructures">PySI Internal Bindings to C++-Datastructures</h3>
<p>The following sections describes the special datastructures of PySI which <strong>must</strong> be used in SI-Plugins. These datastructures originate from SIGRun and are exposed via C++-bindings which are generated with Boost.Python. The PySI API streamlines their usage.</p>
<h4 id="point2">Point2</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" title="1">    p <span class="op">=</span> PySI.Point2(<span class="dv">5</span>, <span class="dv">5</span>)</a></code></pre></div>
<p>Summary:</p>
<ul>
<li>custom datastructure to represent 2D points</li>
<li>API users <strong>must</strong> provide two float values (x, y) to the constructor</li>
<li>Point2 is a custom <em>initialization only</em> exposure of the datatype <em>glm::vec2</em> <a href="#refs">[5]</a></li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h4 id="point3">Point3</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb9-1" title="1">    p <span class="op">=</span> PySI.Point3(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>)</a></code></pre></div>
<p>Summary:</p>
<ul>
<li>custom datastructure to represent 3D points</li>
<li>API users <strong>must</strong> provide three float values (x, y, z) to the constructor</li>
<li>API users <strong>should</strong> should initialize the <em>z</em>-value to <em>1</em></li>
<li>Point3 is a custom <em>initialization only</em> exposure of the datatype <em>glm::vec3</em> <a href="#refs">[5]</a></li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h4 id="color">Color</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" title="1">    color <span class="op">=</span> PySI.Color(<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">255</span>)</a></code></pre></div>
<p>Summary:</p>
<ul>
<li>custom datastructure to represent RGBA colors</li>
<li>API users <strong>must</strong> provide four float values (r, g, b, a) to the constructor</li>
<li>Color is a custom <em>initialization only</em> exposure of the datatype <em>glm::vec4</em> <a href="#refs">[5]</a></li>
</ul>
<h4 id="linkrelation">LinkRelation</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb11-1" title="1">    lr <span class="op">=</span> PySI.LinkRelation(source_uuid, source_attrib, target_uuid, target_attrib)</a></code></pre></div>
<p>Summary:</p>
<ul>
<li>custom datastructure to represent linking relationships</li>
<li>API Users <strong>must</strong> provide four str values (source_effect_uuid, source_effect_attribute, target_effect_uuid, target_effect_attribute) to the constructor</li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h4 id="pointvector">PointVector</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb12-1" title="1">    <span class="co"># construction</span></a>
<a class="sourceLine" id="cb12-2" title="2">    pts <span class="op">=</span> PySI.PointVector()  <span class="co"># empty</span></a>
<a class="sourceLine" id="cb12-3" title="3">    pts <span class="op">=</span> PySI.PointVector([[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], ..., [m, n, <span class="dv">1</span>]]) <span class="co"># list of points</span></a>
<a class="sourceLine" id="cb12-4" title="4"></a>
<a class="sourceLine" id="cb12-5" title="5">    <span class="co"># appending</span></a>
<a class="sourceLine" id="cb12-6" title="6">    pts.append(PySI.Point3(x, y, z)) <span class="co"># appending Point3 directly</span></a>
<a class="sourceLine" id="cb12-7" title="7">    pts.append([x, y, z]) <span class="co"># appending Point3 python list of exactly three floats</span></a></code></pre></div>
<p>Summary:</p>
<ul>
<li>custom datastructure to represent a list of Point3 datastructures</li>
<li>PointVector is usable in a pythonic way equally to python lists</li>
<li>API Users <strong>must</strong> provide a list of lists of three floats to the constructor or leave it empty</li>
<li>API Users <strong>must</strong> provide three floats inside the inner list when using python lists for initialization or appending</li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h4 id="linkrelationvector">LinkRelationVector</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb13-1" title="1">    <span class="co"># construction with list of link relationships</span></a>
<a class="sourceLine" id="cb13-2" title="2">    lrv <span class="op">=</span> PySI.LinkRelationVector()  <span class="co"># empty</span></a>
<a class="sourceLine" id="cb13-3" title="3">    lrv <span class="op">=</span> PySI.PointVector([[source_uuid, source_attribute, target_uuid, </a>
<a class="sourceLine" id="cb13-4" title="4">                             target_attribute], ...]) </a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6">    <span class="co"># appending LinkRelation directly</span></a>
<a class="sourceLine" id="cb13-7" title="7">    pts.append(PySI.LinkRelation(source_uuid, source_attrib, target_uuid,</a>
<a class="sourceLine" id="cb13-8" title="8">                                 target_attrib))  </a>
<a class="sourceLine" id="cb13-9" title="9">    </a>
<a class="sourceLine" id="cb13-10" title="10">    <span class="co"># appending LinkRelation indirectly with python list of exactly four strings</span></a>
<a class="sourceLine" id="cb13-11" title="11">    pts.append([source_uuid, source_attrib, target_uuid, target_attrib])  </a></code></pre></div>
<p>Summary:</p>
<ul>
<li>custom datastructure to represent a list of link relationships</li>
<li>LinkRelationVector is usable in a pythonic way equally to python lists</li>
<li>API Users <strong>must</strong> provide a list of lists of four str values to the constructor or leave it empty</li>
<li>API Users <strong>must</strong> provide four str-values inside the inner list when using python lists for initialization or appending</li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h4 id="stringvector">StringVector</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb14-1" title="1">    <span class="co"># construction</span></a>
<a class="sourceLine" id="cb14-2" title="2">    sv <span class="op">=</span> PySI.StringVector()  <span class="co"># empty</span></a>
<a class="sourceLine" id="cb14-3" title="3">    sv <span class="op">=</span> PySI.StringVector([<span class="st">&quot;str&quot;</span>, <span class="st">&quot;str2&quot;</span>, ..., <span class="st">&quot;strn&quot;</span>])  <span class="co"># list of link relationships</span></a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5">    <span class="co"># appending</span></a>
<a class="sourceLine" id="cb14-6" title="6">    sv.append(<span class="st">&quot;str&quot;</span>)  <span class="co"># appending str value directly</span></a></code></pre></div>
<p>Summary:</p>
<ul>
<li>custom datastructure to represent a list of strings</li>
<li>StringVector is usable in a pythonic way equally to python lists</li>
<li>StringVector is a custom exposure of <strong>std::vector<std::string></strong></li>
<li>API Users <strong>must</strong> provide a list of str values to the constructor or leave it empty</li>
<li>API Users <strong>must</strong> provide a str-value when appending to a StringVector</li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h4 id="partialcontour">PartialContour</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb15-1" title="1">    <span class="co"># construction is not performed manually</span></a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="co"># appending of new cursor id</span></a>
<a class="sourceLine" id="cb15-4" title="4">    <span class="co"># adding PointVector value directly</span></a>
<a class="sourceLine" id="cb15-5" title="5">    <span class="va">self</span>.__partial_regions__[cursor_uuid] <span class="op">=</span> PySI.PointVector()  </a>
<a class="sourceLine" id="cb15-6" title="6"></a>
<a class="sourceLine" id="cb15-7" title="7">    <span class="co"># appending of point according to cursor id</span></a>
<a class="sourceLine" id="cb15-8" title="8">    <span class="co"># adding PointVector value directly</span></a>
<a class="sourceLine" id="cb15-9" title="9">    <span class="co"># adding PointVector value directly</span></a>
<a class="sourceLine" id="cb15-10" title="10">    <span class="va">self</span>.__partial_regions__[cursor_uuid].append(PySI.Point3(x, y, <span class="dv">1</span>))  </a>
<a class="sourceLine" id="cb15-11" title="11">    <span class="va">self</span>.__partial_regions__[cursor_uuid].append([x, y, <span class="dv">1</span>])  </a></code></pre></div>
<ul>
<li>Custom datastructure to represent a contour/shape which is currently drawn by an end-user</li>
<li>PartialContour is usable in a pythonic way equally to python dicts</li>
<li>PartialContour is custom exposure of a <strong>std::map&lt;std::string, std::vector<glm::vec3>&gt;</strong> datastructure</li>
<li>PartialContour uses uuids of cursor plugins as key (str value) for values of type PointVector</li>
<li>API users <strong>must</strong> provide string/PointVector key/value pair to add data</li>
<li>API users <strong>must</strong> provide a valid uuid of a valid cursor as key</li>
<li>API Users <strong>must not</strong> call the constructor directly as this is handled by PySI</li>
<li>API Users <strong>should not</strong> require to use this datastructure directly as it is only required when building a <em>canvas</em> plugin</li>
<li>API Users <strong>should not</strong> build a new <em>canvas</em> plugin</li>
</ul>
<h4 id="string2functionmap">String2FunctionMap</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb16-1" title="1">    <span class="co"># e.g. linking relationships eligible for emission are stored in a </span></a>
<a class="sourceLine" id="cb16-2" title="2">    <span class="co"># String2FunctionMap per SI-plugin</span></a>
<a class="sourceLine" id="cb16-3" title="3">    </a>
<a class="sourceLine" id="cb16-4" title="4">    <span class="kw">def</span> link_emission():</a>
<a class="sourceLine" id="cb16-5" title="5">        <span class="cf">return</span> <span class="st">&quot;emit&quot;</span>    </a>
<a class="sourceLine" id="cb16-6" title="6">    </a>
<a class="sourceLine" id="cb16-7" title="7">    <span class="co"># construction</span></a>
<a class="sourceLine" id="cb16-8" title="8">    link_emit <span class="op">=</span> PySI.String2FunctionMap()</a>
<a class="sourceLine" id="cb16-9" title="9">    link_emit <span class="op">=</span> PySI.String2FunctionMap({<span class="st">&quot;my_link_attribute_to_emit&quot;</span>, link_emission})</a>
<a class="sourceLine" id="cb16-10" title="10">    </a>
<a class="sourceLine" id="cb16-11" title="11">    <span class="co"># assignment</span></a>
<a class="sourceLine" id="cb16-12" title="12">    link_emit[<span class="st">&quot;my_link_attribute_to_emit&quot;</span>] <span class="op">=</span> link_emission</a></code></pre></div>
<ul>
<li>Custom datastructure to represent key/value pairs of str-values and python functions</li>
<li>String2FunctionMap is usable in a pythonic way equally to python dicts</li>
<li>API Users <strong>must</strong> provide a python dict with str-value keys and functions as values to the constructor or leave it empty</li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h4 id="string2string2functionmapmap">String2String2FunctionMapMap</h4>
<p>In linking action source effect:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb17-1" title="1">    <span class="co"># emission functions used in example below</span></a>
<a class="sourceLine" id="cb17-2" title="2">    <span class="kw">def</span> emit_data(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb17-3" title="3">        <span class="cf">return</span> x, y, z, <span class="va">self</span>._uuid</a>
<a class="sourceLine" id="cb17-4" title="4"></a>
<a class="sourceLine" id="cb17-5" title="5">    <span class="va">self</span>.enable_link_emission(<span class="st">&quot;my_source_attribute&quot;</span>, <span class="va">self</span>.emit_data)</a></code></pre></div>
<p>In linking action target effect</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb18-1" title="1">    <span class="co"># e.g. linking relationships eligible for reception are stored in a </span></a>
<a class="sourceLine" id="cb18-2" title="2">    <span class="co"># String2String2FunctionMapMap per SI-plugin</span></a>
<a class="sourceLine" id="cb18-3" title="3">    <span class="va">self</span>.enable_link_reception(<span class="st">&quot;my_source_attribute&quot;</span>, <span class="st">&quot;my_target &quot;</span>, <span class="va">self</span>.receive_data)</a>
<a class="sourceLine" id="cb18-4" title="4"></a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="co"># number of args is dependant on the number of returned values (tuple) of </span></a>
<a class="sourceLine" id="cb18-6" title="6">    <span class="co"># the emission function</span></a>
<a class="sourceLine" id="cb18-7" title="7">    <span class="kw">def</span> receive_data(<span class="va">self</span>, x, y, z, source_uuid):</a>
<a class="sourceLine" id="cb18-8" title="8">        <span class="co"># use data of linking action    </span></a>
<a class="sourceLine" id="cb18-9" title="9">        <span class="cf">pass</span>    </a>
<a class="sourceLine" id="cb18-10" title="10">    </a>
<a class="sourceLine" id="cb18-11" title="11">    <span class="co"># construction</span></a>
<a class="sourceLine" id="cb18-12" title="12">    link_recv <span class="op">=</span> PySI.String2String2FunctionMapMap()</a>
<a class="sourceLine" id="cb18-13" title="13">    </a>
<a class="sourceLine" id="cb18-14" title="14">    link <span class="op">=</span> {<span class="st">&quot;my_source_link_attribute&quot;</span>: {<span class="st">&quot;my_target_link_attribute&quot;</span>: <span class="va">self</span>.receive_data}</a>
<a class="sourceLine" id="cb18-15" title="15">    link_recv <span class="op">=</span> PySI.String2String2FunctionMapMap(link)</a>
<a class="sourceLine" id="cb18-16" title="16">    </a>
<a class="sourceLine" id="cb18-17" title="17">    <span class="co"># assignment</span></a>
<a class="sourceLine" id="cb18-18" title="18">    link_recv[<span class="st">&quot;my_source_link_attribute&quot;</span>][<span class="st">&quot;my_target_link_attribute&quot;</span>] <span class="op">=</span> <span class="va">self</span>.receive_data</a></code></pre></div>
<ul>
<li>Custom datastructure to represent key/value pairs of str-values and String2FunctionMap</li>
<li>String2String2FunctionMapMap is usable in a pythonic way equally to python dicts containing values of dicts</li>
<li>API Users <strong>must</strong> provide a python dict with str-value keys and dicts as values, which represent String2FunctionMap, to the constructor or leave it empty</li>
<li>API Users <strong>may not</strong> require to use this datastructure directly</li>
</ul>
<h2 id="impl_tag">Example: Implementation of a Tag-Effect</h2>
<h3 id="building-tag.py">Building Tag.py</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb19-1" title="1">    </a>
<a class="sourceLine" id="cb19-2" title="2"><span class="im">from</span> libPySI <span class="im">import</span> PySI</a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="im">from</span> plugins.standard_environment_library.SIEffect <span class="im">import</span> SIEffect</a>
<a class="sourceLine" id="cb19-5" title="5"></a>
<a class="sourceLine" id="cb19-6" title="6"></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="kw">class</span> Tag(SIEffect):</a>
<a class="sourceLine" id="cb19-8" title="8">    regiontype <span class="op">=</span> PySI.EffectType.SI_CUSTOM</a>
<a class="sourceLine" id="cb19-9" title="9">    regionname <span class="op">=</span> PySI.EffectName.SI_STD_NAME_TAG</a>
<a class="sourceLine" id="cb19-10" title="10">    region_display_name <span class="op">=</span> <span class="st">&quot;Tag&quot;</span></a>
<a class="sourceLine" id="cb19-11" title="11"></a>
<a class="sourceLine" id="cb19-12" title="12">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, shape<span class="op">=</span>PySI.PointVector(), uuid<span class="op">=</span><span class="st">&quot;&quot;</span>, kwargs<span class="op">=</span>{}):</a>
<a class="sourceLine" id="cb19-13" title="13">        <span class="bu">super</span>(Tag, <span class="va">self</span>).<span class="fu">__init__</span>(shape, uuid, <span class="st">&quot;res/tag.png&quot;</span>, Tag.regiontype, </a>
<a class="sourceLine" id="cb19-14" title="14">                                  Tag.regionname, kwargs)</a>
<a class="sourceLine" id="cb19-15" title="15">        <span class="co"># specify which qml file to use</span></a>
<a class="sourceLine" id="cb19-16" title="16">        <span class="va">self</span>.qml_path <span class="op">=</span> <span class="st">&quot;plugins/standard_environment_library/tag/Tag.qml&quot;</span></a>
<a class="sourceLine" id="cb19-17" title="17">            </a>
<a class="sourceLine" id="cb19-18" title="18">        <span class="co"># specify which color a region having the tag-effect should have</span></a>
<a class="sourceLine" id="cb19-19" title="19">        <span class="va">self</span>.color <span class="op">=</span> PySI.Color(<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>)</a>
<a class="sourceLine" id="cb19-20" title="20"></a>
<a class="sourceLine" id="cb19-21" title="21">        <span class="co"># add and enable the tagging effect by specifying its capability and </span></a>
<a class="sourceLine" id="cb19-22" title="22">        <span class="co"># and assigning its collision event functions</span></a>
<a class="sourceLine" id="cb19-23" title="23">        <span class="va">self</span>.enable_effect(<span class="st">&quot;tagging&quot;</span>, SIEffect.EMISSION, <span class="va">self</span>.on_tag_enter_emit,</a>
<a class="sourceLine" id="cb19-24" title="24">                           <span class="va">self</span>.on_tag_continuous_emit, <span class="va">self</span>.on_tag_leave_emit)</a>
<a class="sourceLine" id="cb19-25" title="25"></a>
<a class="sourceLine" id="cb19-26" title="26">    <span class="co"># define the functions needed for collision events with the &quot;tagging&quot; capability</span></a>
<a class="sourceLine" id="cb19-27" title="27">    </a>
<a class="sourceLine" id="cb19-28" title="28">    <span class="co"># when another eligible effect first collides with this one, emit that the </span></a>
<a class="sourceLine" id="cb19-29" title="29">    <span class="co"># other one should be tagged</span></a>
<a class="sourceLine" id="cb19-30" title="30">    <span class="kw">def</span> on_tag_enter_emit(<span class="va">self</span>, other):</a>
<a class="sourceLine" id="cb19-31" title="31">        <span class="cf">return</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb19-32" title="32">    </a>
<a class="sourceLine" id="cb19-33" title="33">    <span class="co"># it makes no sense to redundantly tag the other effect on every collision </span></a>
<a class="sourceLine" id="cb19-34" title="34">    <span class="co"># event, so we leave this blank </span></a>
<a class="sourceLine" id="cb19-35" title="35">    <span class="kw">def</span> on_tag_continuous_emit(<span class="va">self</span>, other):</a>
<a class="sourceLine" id="cb19-36" title="36">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb19-37" title="37">    </a>
<a class="sourceLine" id="cb19-38" title="38">    <span class="co"># we want to keep the tag beyond collision, so we leave this also blank</span></a>
<a class="sourceLine" id="cb19-39" title="39">    <span class="kw">def</span> on_tag_leave_emit(<span class="va">self</span>, other):</a>
<a class="sourceLine" id="cb19-40" title="40">        <span class="cf">pass</span> </a></code></pre></div>
<p>Using the Tag-effect within a region yields something like this when drawn in SIGRun: <img src="res/tag_without_tex.png" style="width:40.0%" /></p>
<p>Even though we specified a texture path (res/tag.png) in the constructor and specified a qml-file path (plugins/standard_environment_library/tag/Tag.qml), we do not see the texture on top of our region. In order to to make this styling visible we have to build the qml-file which associated with the Tag-effect.</p>
<h3 id="building-tag.qml">Building Tag.qml</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="im">import</span> QtQuick <span class="fl">2.7</span></a>
<a class="sourceLine" id="cb20-2" title="2"></a>
<a class="sourceLine" id="cb20-3" title="3">Item</a>
<a class="sourceLine" id="cb20-4" title="4"><span class="op">{</span></a>
<a class="sourceLine" id="cb20-5" title="5">    <span class="co">// apply data provided by the SI-plugin</span></a>
<a class="sourceLine" id="cb20-6" title="6">    <span class="kw">function</span> <span class="at">updateData</span>(data)</a>
<a class="sourceLine" id="cb20-7" title="7">    <span class="op">{</span></a>
<a class="sourceLine" id="cb20-8" title="8">        <span class="va">image</span>.<span class="at">width</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">img_width</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-9" title="9">        <span class="va">image</span>.<span class="at">height</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">img_height</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-10" title="10">        <span class="va">image</span>.<span class="at">source</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">img_path</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-11" title="11"></a>
<a class="sourceLine" id="cb20-12" title="12">        <span class="va">image</span>.<span class="va">anchors</span>.<span class="at">leftMargin</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">widget_width</span> / <span class="dv">2</span> <span class="op">-</span> <span class="va">image</span>.<span class="at">width</span> / <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-13" title="13">        <span class="va">image</span>.<span class="va">anchors</span>.<span class="at">topMargin</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">widget_height</span> / <span class="dv">2</span> <span class="op">-</span> <span class="va">image</span>.<span class="at">height</span> / <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-14" title="14">    <span class="op">}</span></a>
<a class="sourceLine" id="cb20-15" title="15"></a>
<a class="sourceLine" id="cb20-16" title="16">    <span class="dt">id</span><span class="op">:</span> container</a>
<a class="sourceLine" id="cb20-17" title="17">    <span class="dt">visible</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb20-18" title="18"></a>
<a class="sourceLine" id="cb20-19" title="19">    Image <span class="op">{</span></a>
<a class="sourceLine" id="cb20-20" title="20">        <span class="dt">id</span><span class="op">:</span> image</a>
<a class="sourceLine" id="cb20-21" title="21">        <span class="va">anchors</span>.<span class="at">left</span><span class="op">:</span> <span class="va">parent</span>.<span class="at">left</span></a>
<a class="sourceLine" id="cb20-22" title="22">        <span class="va">anchors</span>.<span class="at">top</span><span class="op">:</span> <span class="va">parent</span>.<span class="at">top</span></a>
<a class="sourceLine" id="cb20-23" title="23"></a>
<a class="sourceLine" id="cb20-24" title="24">        <span class="dt">visible</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb20-25" title="25">    <span class="op">}</span></a>
<a class="sourceLine" id="cb20-26" title="26"><span class="op">}</span></a></code></pre></div>
<p>Above example is the default qml-file for each SI-Plugin. It provides the functionality to draw a texture on top of a region and center it in the region. This file can automatically be created if the SIQML file template is used. PySI SIEffect automatically manages texture application once a texture path is provided in the constructor of an effect. This may look like this (in SIEffect constructor):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb21-1" title="1"><span class="va">self</span>.texture_path <span class="op">=</span> texture_path</a>
<a class="sourceLine" id="cb21-2" title="2"></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="cf">if</span> <span class="va">self</span>.texture_path <span class="op">!=</span> <span class="st">&quot;&quot;</span>:</a>
<a class="sourceLine" id="cb21-4" title="4">    <span class="co">## member attribute variable storing the width of a texture of a region </span></a>
<a class="sourceLine" id="cb21-5" title="5">    <span class="co"># drawing as a float</span></a>
<a class="sourceLine" id="cb21-6" title="6">    <span class="co">#</span></a>
<a class="sourceLine" id="cb21-7" title="7">    <span class="co"># This value is only set if texture_path is a valid path</span></a>
<a class="sourceLine" id="cb21-8" title="8">    <span class="va">self</span>.texture_width <span class="op">=</span> <span class="dv">75</span></a>
<a class="sourceLine" id="cb21-9" title="9"></a>
<a class="sourceLine" id="cb21-10" title="10">    <span class="co">## member attribute variable storing the height of a texture of a region </span></a>
<a class="sourceLine" id="cb21-11" title="11">    <span class="co"># drawing as a float</span></a>
<a class="sourceLine" id="cb21-12" title="12">    <span class="co">#</span></a>
<a class="sourceLine" id="cb21-13" title="13">    <span class="co"># This value is only set if texture_path is a valid path</span></a>
<a class="sourceLine" id="cb21-14" title="14">    <span class="va">self</span>.texture_height <span class="op">=</span> <span class="dv">75</span></a>
<a class="sourceLine" id="cb21-15" title="15">    </a>
<a class="sourceLine" id="cb21-16" title="16">    <span class="co"># apply data in QML </span></a>
<a class="sourceLine" id="cb21-17" title="17">    <span class="va">self</span>.__set_data__(<span class="st">&quot;img_width&quot;</span>, <span class="va">self</span>.texture_width, PySI.DataType.INT)</a>
<a class="sourceLine" id="cb21-18" title="18">    <span class="va">self</span>.__set_data__(<span class="st">&quot;img_height&quot;</span>, <span class="va">self</span>.texture_height, PySI.DataType.INT)</a>
<a class="sourceLine" id="cb21-19" title="19">    <span class="va">self</span>.__set_data__(<span class="st">&quot;img_path&quot;</span>, <span class="va">self</span>.texture_path, PySI.DataType.STRING)</a>
<a class="sourceLine" id="cb21-20" title="20">    <span class="va">self</span>.__set_data__(<span class="st">&quot;widget_width&quot;</span>, <span class="va">self</span>.width, PySI.DataType.FLOAT)</a>
<a class="sourceLine" id="cb21-21" title="21">    <span class="va">self</span>.__set_data__(<span class="st">&quot;widget_height&quot;</span>, <span class="va">self</span>.height, PySI.DataType.FLOAT)</a></code></pre></div>
<p>Now that we have created a qml-file for our SI-Plugin, we finally can see the region texture on top of our region: <img src="res/tag_with_tex.png" alt="region with tag effect with texture" style="width:40.0%" /></p>
<p>Now that we can fully draw our newly created Tag-effect in SIGRun, we want to see it in action. In order to do so, we have to adjust or create effects which can receive Tag-effects.</p>
<h3 id="adjusting-a-receiver-effect">Adjusting a receiver effect</h3>
<p>For this example, we expand the TextFile-plugin from the SI standard environment library. First, we have to enable the Tag-effect in TextFile.py.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb22-1" title="1">    <span class="co"># in the constructor</span></a>
<a class="sourceLine" id="cb22-2" title="2">    <span class="co"># note that the &quot;tagging&quot; capability has to be received here</span></a>
<a class="sourceLine" id="cb22-3" title="3">    <span class="co"># we only implemented on_enter in Tag.py so here we only need on_enter as well</span></a>
<a class="sourceLine" id="cb22-4" title="4">    <span class="va">self</span>.enable_effect(<span class="st">&quot;tagging&quot;</span>, <span class="va">self</span>.RECEPTION, <span class="va">self</span>.on_tag_enter_recv, <span class="va">None</span>, <span class="va">None</span>)</a>
<a class="sourceLine" id="cb22-5" title="5"></a>
<a class="sourceLine" id="cb22-6" title="6">    <span class="co"># outside of the constructor but inside the class, we have to define </span></a>
<a class="sourceLine" id="cb22-7" title="7">    <span class="co"># on_tag_enter_recv</span></a>
<a class="sourceLine" id="cb22-8" title="8">    <span class="co"># note that we have the is_tagged parameter due to returning one value </span></a>
<a class="sourceLine" id="cb22-9" title="9">    <span class="co"># in the emission function in Tag.py    </span></a>
<a class="sourceLine" id="cb22-10" title="10">    <span class="co"># modify qml in order to show the tag on a region having the TextFile-effect</span></a>
<a class="sourceLine" id="cb22-11" title="11">    <span class="kw">def</span> on_tag_enter_recv(<span class="va">self</span>, is_tagged):</a>
<a class="sourceLine" id="cb22-12" title="12">        <span class="va">self</span>.set_QML_data(<span class="st">&quot;visible&quot;</span>, is_tagged, PySI.DataType.BOOL)         </a></code></pre></div>
<p>Additionally, we have to adjust TextFile.qml as well to support this new functionality. In updateData(data)-function we add the line:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1">    <span class="kw">function</span> <span class="at">updateData</span>(data)</a>
<a class="sourceLine" id="cb23-2" title="2">    <span class="op">{</span></a>
<a class="sourceLine" id="cb23-3" title="3">        <span class="co">// .</span></a>
<a class="sourceLine" id="cb23-4" title="4">        <span class="co">// .</span></a>
<a class="sourceLine" id="cb23-5" title="5">        <span class="co">// .</span></a>
<a class="sourceLine" id="cb23-6" title="6">        </a>
<a class="sourceLine" id="cb23-7" title="7">       <span class="va">tag</span>.<span class="at">visible</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">visible</span><span class="op">;</span></a>
<a class="sourceLine" id="cb23-8" title="8">    <span class="op">}</span></a></code></pre></div>
<p>And within the container component (<em>Item</em>), we add a <em>Rectangle</em> component:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1">    Item</a>
<a class="sourceLine" id="cb24-2" title="2">    <span class="op">{</span></a>
<a class="sourceLine" id="cb24-3" title="3">        <span class="kw">function</span> <span class="at">updateData</span>(data)</a>
<a class="sourceLine" id="cb24-4" title="4">        <span class="op">{</span></a>
<a class="sourceLine" id="cb24-5" title="5">            <span class="co">// .</span></a>
<a class="sourceLine" id="cb24-6" title="6">            <span class="co">// .</span></a>
<a class="sourceLine" id="cb24-7" title="7">            <span class="co">// .</span></a>
<a class="sourceLine" id="cb24-8" title="8">    </a>
<a class="sourceLine" id="cb24-9" title="9">            <span class="va">tag</span>.<span class="at">visible</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">visible</span><span class="op">;</span></a>
<a class="sourceLine" id="cb24-10" title="10">        <span class="op">}</span></a>
<a class="sourceLine" id="cb24-11" title="11">    </a>
<a class="sourceLine" id="cb24-12" title="12">        <span class="dt">id</span><span class="op">:</span> container</a>
<a class="sourceLine" id="cb24-13" title="13">    </a>
<a class="sourceLine" id="cb24-14" title="14">        <span class="dt">visible</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb24-15" title="15"></a>
<a class="sourceLine" id="cb24-16" title="16">        <span class="co">// .</span></a>
<a class="sourceLine" id="cb24-17" title="17">        <span class="co">// .</span></a>
<a class="sourceLine" id="cb24-18" title="18">        <span class="co">// .</span></a>
<a class="sourceLine" id="cb24-19" title="19">    </a>
<a class="sourceLine" id="cb24-20" title="20">        Rectangle <span class="op">{</span></a>
<a class="sourceLine" id="cb24-21" title="21">           <span class="dt">id</span><span class="op">:</span> tag</a>
<a class="sourceLine" id="cb24-22" title="22">           <span class="dt">width</span><span class="op">:</span> <span class="dv">15</span></a>
<a class="sourceLine" id="cb24-23" title="23">           <span class="dt">height</span><span class="op">:</span> <span class="dv">15</span></a>
<a class="sourceLine" id="cb24-24" title="24">           <span class="dt">color</span><span class="op">:</span> <span class="st">&quot;blue&quot;</span></a>
<a class="sourceLine" id="cb24-25" title="25">           <span class="dt">visible</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb24-26" title="26">        <span class="op">}</span></a>
<a class="sourceLine" id="cb24-27" title="27">    <span class="op">}</span></a></code></pre></div>
<p>And finally after that, we can visually tag our TextFiles:</p>
<p><img src="res/pre_tag.png" style="width:30.0%" /> <img src="res/tag.png" style="width:30.0%" /> <img src="res/post_tag.png" style="width:30.0%" /></p>
<p>However, this is a minimal example for visually tagging a TextFile. Of course, you can expand this approach by passing meta data, use different colors and shapes, according to your preferences and requirements.</p>
<h2 id="a-more-complex-use-case-example-plot.py-and-plot.qml">A More Complex Use Case Example: Plot.py and Plot.qml</h2>
<p>Preface:</p>
<p>The Tag-Effect is fairly simple and may hide the possibilities of SI, or at least makes it more difficult to grasp what is actually possible. To see the more powerful side of SI, you should have a look at the following sections. In that sections, an SI-Plugin is implemented which displays the result of a <strong>matplotlib</strong> plot within an <em>interactive region</em>.</p>
<p>Prerequesites:</p>
<ul>
<li>SIGRun <em>must</em> represent <em>interactive regions</em> as Qt5 QWidgets which <em>should</em> have exactly one QML QQuickWidget as a child object</li>
<li>SIGRun <em>must</em> apply the size of the axis-aligned bounding box (AABB) of a region drawing to that region’s Qwidget’s size to be displayed correctly</li>
<li>SIGRun <em>may</em> display regions in unexpected ways if data such as images exceed the regions’ AABB’s</li>
</ul>
<p>Application:</p>
<ul>
<li>API Users <em>must</em> define a new and big enough shape or contour of an effect’s associated <em>interactive region</em> for data such as images to be properly displayed by SIRen if the region’s original AABB’s dimenions are exceeded</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb25-1" title="1"><span class="im">from</span> libPySI <span class="im">import</span> PySI</a>
<a class="sourceLine" id="cb25-2" title="2"><span class="im">from</span> plugins.standard_environment_library.SIEffect <span class="im">import</span> SIEffect</a>
<a class="sourceLine" id="cb25-3" title="3"><span class="im">import</span> matplotlib</a>
<a class="sourceLine" id="cb25-4" title="4">matplotlib.use(<span class="st">&#39;Agg&#39;</span>)  <span class="co"># required</span></a>
<a class="sourceLine" id="cb25-5" title="5"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb25-6" title="6"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb25-7" title="7"></a>
<a class="sourceLine" id="cb25-8" title="8"><span class="kw">class</span> Plot(SIEffect):</a>
<a class="sourceLine" id="cb25-9" title="9">    regiontype <span class="op">=</span> PySI.EffectType.SI_CUSTOM</a>
<a class="sourceLine" id="cb25-10" title="10">    regionname <span class="op">=</span> <span class="st">&quot;__PLOT__&quot;</span></a>
<a class="sourceLine" id="cb25-11" title="11">    region_display_name <span class="op">=</span> <span class="st">&quot;Plot&quot;</span></a>
<a class="sourceLine" id="cb25-12" title="12"></a>
<a class="sourceLine" id="cb25-13" title="13">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, shape<span class="op">=</span>PySI.PointVector(), uuid<span class="op">=</span><span class="st">&quot;&quot;</span>, kwargs<span class="op">=</span>{}):</a>
<a class="sourceLine" id="cb25-14" title="14">        <span class="bu">super</span>(Plot, <span class="va">self</span>).<span class="fu">__init__</span>(shape, uuid, <span class="st">&quot;res/dot-plot.png&quot;</span>, </a>
<a class="sourceLine" id="cb25-15" title="15">                                   Plot.regiontype, Plot.regionname, kwargs)</a>
<a class="sourceLine" id="cb25-16" title="16">        <span class="va">self</span>.qml_path <span class="op">=</span> <span class="st">&quot;plugins/standard_environment_library/plot/Plot.qml&quot;</span></a>
<a class="sourceLine" id="cb25-17" title="17">        <span class="va">self</span>.color <span class="op">=</span> PySI.Color(<span class="dv">63</span>, <span class="dv">136</span>, <span class="dv">143</span>, <span class="dv">255</span>)</a>
<a class="sourceLine" id="cb25-18" title="18">    </a>
<a class="sourceLine" id="cb25-19" title="19">        <span class="co"># matplotlib code required to plot a graph</span></a>
<a class="sourceLine" id="cb25-20" title="20">        figure <span class="op">=</span> plt.figure()</a>
<a class="sourceLine" id="cb25-21" title="21">        plot <span class="op">=</span> figure.add_subplot(<span class="dv">111</span>)</a>
<a class="sourceLine" id="cb25-22" title="22"></a>
<a class="sourceLine" id="cb25-23" title="23">        x <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">100</span>, <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb25-24" title="24">        y <span class="op">=</span> np.sin(x) <span class="op">/</span> x</a>
<a class="sourceLine" id="cb25-25" title="25">        plot.plot(x, y)</a>
<a class="sourceLine" id="cb25-26" title="26">    </a>
<a class="sourceLine" id="cb25-27" title="27">        <span class="co"># retrieve the plot as numpy.ndarray</span></a>
<a class="sourceLine" id="cb25-28" title="28">        np_fig <span class="op">=</span> <span class="va">self</span>.fig_2_ndarray(figure)</a>
<a class="sourceLine" id="cb25-29" title="29"></a>
<a class="sourceLine" id="cb25-30" title="30">        <span class="co"># get image dimensions</span></a>
<a class="sourceLine" id="cb25-31" title="31">        <span class="va">self</span>.width, <span class="va">self</span>.height, _ <span class="op">=</span> np_fig.shape</a>
<a class="sourceLine" id="cb25-32" title="32">    </a>
<a class="sourceLine" id="cb25-33" title="33">        <span class="co"># get effect&#39;s associated region&#39;s current x and y coordinates </span></a>
<a class="sourceLine" id="cb25-34" title="34">        <span class="co"># (top left corner of region&#39;s axis-aligned bounding box)</span></a>
<a class="sourceLine" id="cb25-35" title="35">        <span class="co"># for relative_x_pos() and relative_y_pos() see code documentation of PySI</span></a>
<a class="sourceLine" id="cb25-36" title="36">        x <span class="op">=</span> <span class="va">self</span>.relative_x_pos()</a>
<a class="sourceLine" id="cb25-37" title="37">        y <span class="op">=</span> <span class="va">self</span>.relative_y_pos()</a>
<a class="sourceLine" id="cb25-38" title="38">    </a>
<a class="sourceLine" id="cb25-39" title="39">        <span class="co"># current shape may be too small to contain the complete image</span></a>
<a class="sourceLine" id="cb25-40" title="40">        <span class="co"># recompute shape according to image size at the regions position</span></a>
<a class="sourceLine" id="cb25-41" title="41">        <span class="co"># now image exactly fits into the shape (and therefore Qt5 QWidget) </span></a>
<a class="sourceLine" id="cb25-42" title="42">        <span class="va">self</span>.shape <span class="op">=</span> PySI.PointVector([[x, y], [x, y <span class="op">+</span> <span class="va">self</span>.height], </a>
<a class="sourceLine" id="cb25-43" title="43">                                      [x <span class="op">+</span> <span class="va">self</span>.width, y <span class="op">+</span> <span class="va">self</span>.height], </a>
<a class="sourceLine" id="cb25-44" title="44">                                      [x <span class="op">+</span> <span class="va">self</span>.width, y]])</a>
<a class="sourceLine" id="cb25-45" title="45">        </a>
<a class="sourceLine" id="cb25-46" title="46">        <span class="co"># assign new data to QML for styling</span></a>
<a class="sourceLine" id="cb25-47" title="47">        <span class="va">self</span>.set_QML_data(<span class="st">&quot;image&quot;</span>, np_fig.tobytes(), PySI.DataType.BYTES, </a>
<a class="sourceLine" id="cb25-48" title="48">                          {<span class="st">&quot;width&quot;</span>: <span class="va">self</span>.width, <span class="st">&quot;height&quot;</span>: <span class="va">self</span>.height})</a>
<a class="sourceLine" id="cb25-49" title="49"></a>
<a class="sourceLine" id="cb25-50" title="50">        <span class="va">self</span>.set_QML_data(<span class="st">&quot;img_width&quot;</span>, <span class="va">self</span>.width, PySI.DataType.INT)</a>
<a class="sourceLine" id="cb25-51" title="51">        <span class="va">self</span>.set_QML_data(<span class="st">&quot;img_height&quot;</span>, <span class="va">self</span>.height, PySI.DataType.INT)</a>
<a class="sourceLine" id="cb25-52" title="52">        <span class="va">self</span>.set_QML_data(<span class="st">&quot;widget_width&quot;</span>, <span class="va">self</span>.width, PySI.DataType.FLOAT)</a>
<a class="sourceLine" id="cb25-53" title="53">        <span class="va">self</span>.set_QML_data(<span class="st">&quot;widget_height&quot;</span>, <span class="va">self</span>.height, PySI.DataType.FLOAT)</a>
<a class="sourceLine" id="cb25-54" title="54"></a>
<a class="sourceLine" id="cb25-55" title="55">    <span class="co"># helper function for getting a plot as numpy.ndarray</span></a>
<a class="sourceLine" id="cb25-56" title="56">    <span class="kw">def</span> fig_2_ndarray(<span class="va">self</span>, fig, mode<span class="op">=</span><span class="st">&quot;rgba&quot;</span>):</a>
<a class="sourceLine" id="cb25-57" title="57">        fig.canvas.draw()</a>
<a class="sourceLine" id="cb25-58" title="58"></a>
<a class="sourceLine" id="cb25-59" title="59">        w, h <span class="op">=</span> fig.canvas.get_width_height()</a>
<a class="sourceLine" id="cb25-60" title="60">        buf <span class="op">=</span> np.fromstring(fig.canvas.tostring_argb(), dtype<span class="op">=</span>np.uint8)</a>
<a class="sourceLine" id="cb25-61" title="61">        buf.shape <span class="op">=</span> (w, h, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb25-62" title="62"></a>
<a class="sourceLine" id="cb25-63" title="63">        <span class="cf">if</span> mode <span class="op">==</span> <span class="st">&quot;rgba&quot;</span>:</a>
<a class="sourceLine" id="cb25-64" title="64">            <span class="co"># convert to rgba</span></a>
<a class="sourceLine" id="cb25-65" title="65">            buf <span class="op">=</span> np.roll(buf, <span class="dv">3</span>, axis<span class="op">=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-66" title="66">            <span class="cf">return</span> buf</a>
<a class="sourceLine" id="cb25-67" title="67">        <span class="cf">elif</span> mode <span class="op">==</span> <span class="st">&quot;argb&quot;</span>:</a>
<a class="sourceLine" id="cb25-68" title="68">            <span class="cf">return</span> buf</a></code></pre></div>
<p>QML-file:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1"><span class="im">import</span> QtQuick <span class="fl">2.7</span></a>
<a class="sourceLine" id="cb26-2" title="2"><span class="im">import</span> siqml <span class="fl">1.0</span></a>
<a class="sourceLine" id="cb26-3" title="3"></a>
<a class="sourceLine" id="cb26-4" title="4">Item <span class="op">{</span></a>
<a class="sourceLine" id="cb26-5" title="5">    <span class="kw">function</span> <span class="at">updateData</span>(data) <span class="op">{</span></a>
<a class="sourceLine" id="cb26-6" title="6">        <span class="cf">if</span>(<span class="va">data</span>.<span class="at">image</span>)</a>
<a class="sourceLine" id="cb26-7" title="7">        <span class="op">{</span></a>
<a class="sourceLine" id="cb26-8" title="8">            <span class="va">plot_texture</span>.<span class="at">image</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">image</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-9" title="9">            <span class="va">plot_texture</span>.<span class="at">width</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">img_width</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-10" title="10">            <span class="va">plot_texture</span>.<span class="at">height</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">img_height</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-11" title="11"></a>
<a class="sourceLine" id="cb26-12" title="12">            <span class="va">plot_texture</span>.<span class="va">anchors</span>.<span class="at">leftMargin</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">widget_width</span> / <span class="dv">2</span> <span class="op">-</span> <span class="va">plot_texture</span>.<span class="at">width</span> / <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-13" title="13">            <span class="va">plot_texture</span>.<span class="va">anchors</span>.<span class="at">topMargin</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">widget_height</span> / <span class="dv">2</span> <span class="op">-</span> <span class="va">plot_texture</span>.<span class="at">height</span> / <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-14" title="14">        <span class="op">}</span></a>
<a class="sourceLine" id="cb26-15" title="15"></a>
<a class="sourceLine" id="cb26-16" title="16">        <span class="va">idle_texture</span>.<span class="at">width</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">icon_width</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-17" title="17">        <span class="va">idle_texture</span>.<span class="at">height</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">icon_height</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-18" title="18">        <span class="va">idle_texture</span>.<span class="at">source</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">img_path</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-19" title="19"></a>
<a class="sourceLine" id="cb26-20" title="20">        <span class="va">idle_texture</span>.<span class="va">anchors</span>.<span class="at">leftMargin</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">widget_width</span> / <span class="dv">2</span> <span class="op">-</span> <span class="va">idle_texture</span>.<span class="at">width</span> / <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-21" title="21">        <span class="va">idle_texture</span>.<span class="va">anchors</span>.<span class="at">topMargin</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">widget_height</span> / <span class="dv">2</span> <span class="op">-</span> <span class="va">idle_texture</span>.<span class="at">height</span> / <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-22" title="22">    <span class="op">}</span></a>
<a class="sourceLine" id="cb26-23" title="23"></a>
<a class="sourceLine" id="cb26-24" title="24">    <span class="dt">id</span><span class="op">:</span> container</a>
<a class="sourceLine" id="cb26-25" title="25">        <span class="dt">visible</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb26-26" title="26"></a>
<a class="sourceLine" id="cb26-27" title="27">    Image <span class="op">{</span></a>
<a class="sourceLine" id="cb26-28" title="28">        <span class="dt">id</span><span class="op">:</span> idle_texture</a>
<a class="sourceLine" id="cb26-29" title="29"></a>
<a class="sourceLine" id="cb26-30" title="30">        <span class="va">anchors</span>.<span class="at">left</span><span class="op">:</span> <span class="va">parent</span>.<span class="at">left</span></a>
<a class="sourceLine" id="cb26-31" title="31">        <span class="va">anchors</span>.<span class="at">top</span><span class="op">:</span> <span class="va">parent</span>.<span class="at">top</span></a>
<a class="sourceLine" id="cb26-32" title="32">    <span class="op">}</span></a>
<a class="sourceLine" id="cb26-33" title="33"></a>
<a class="sourceLine" id="cb26-34" title="34">    PlotItem <span class="op">{</span></a>
<a class="sourceLine" id="cb26-35" title="35">        <span class="dt">id</span><span class="op">:</span> plot_texture</a>
<a class="sourceLine" id="cb26-36" title="36">    <span class="op">}</span></a>
<a class="sourceLine" id="cb26-37" title="37"><span class="op">}</span></a></code></pre></div>
<p>Without adjusting the shape of the target <em>interactive region</em>, behaviour such as this can be expected:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb27-1" title="1">    <span class="co"># shape will not be adjusted</span></a>
<a class="sourceLine" id="cb27-2" title="2">    <span class="co"># self.shape = PySI.PointVector([[x, y], [x, y + self.height], </span></a>
<a class="sourceLine" id="cb27-3" title="3">    <span class="co">#                               [x + self.width, y + self.height], [x + self.width, y]])</span></a></code></pre></div>
<p><img src="res/no_shape_adjustment_sketch.png" title="Drawing an *interactive region* intended to contain a plot" alt="img" style="width:40.0%" /> <img src="res/no_shape_adjustment_plot.png" title="Plot is rendered within the *interactive region*, however the image is cut-off due to no adjustment of the region&#39;s shape" alt="img" style="width:40.0%" /></p>
<p>However, adjusting the shape of the target region yields the desired output:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb28-1" title="1">    <span class="co"># shape will be adjusted</span></a>
<a class="sourceLine" id="cb28-2" title="2">    <span class="va">self</span>.shape <span class="op">=</span> PySI.PointVector([[x, y], [x, y <span class="op">+</span> <span class="va">self</span>.height], </a>
<a class="sourceLine" id="cb28-3" title="3">                                  [x <span class="op">+</span> <span class="va">self</span>.width, y <span class="op">+</span> <span class="va">self</span>.height], [x <span class="op">+</span> <span class="va">self</span>.width, y]])</a></code></pre></div>
<p><img src="res/shape_adjustment_sketch.png" title="Drawing an *interactive region* intended to contain a plot" alt="img" style="width:40.0%" /> <img src="res/shape_adjustment_plot.png" title="Plot is rendered within the *interactive region* and the image is not cut-off due to the adjustment of the region&#39;s shape" alt="img" style="width:40.0%" /></p>
<p>Summary:</p>
<ul>
<li>API Users <em>must</em> use self.shape in conjunction with the assignment of a new PySI.PointVector which is initialized with a python list (see example above) to reassign the shape of the effect’s associated shape or contour</li>
<li>API Users <em>should</em> compute a new and big enough shape to fit an image which exceeds the region’s AABB’s current dimensions as the AABB <strong>must</strong> be viewed as the QML container</li>
<li>API Users <em>may</em> encounter unexpected behaviour in terms of rendering a region when its styling data and size do not match</li>
</ul>
<h2 id="refs">References</h2>
<p>[1] Wimmer, R., &amp; Hahn, J. (2018). A Concept for Sketchable Workspaces and Workflows. <a>https://epub.uni-regensburg.de/36818/1/A%20Concept%20for%20Sketchable%20Workspaces%20and%20Workflows.pdf</a></p>
<p>[2] RFC2119. https://tools.ietf.org/html/rfc2119</p>
<p>[3] Boost.Python. https://www.boost.org/doc/libs/1_73_0/libs/python/doc/html/index.html</p>
<p>[4] QML. https://doc.qt.io/qt-5/qtqml-index.html</p>
<p>[5] GLM. https://glm.g-truc.net/0.9.9/index.html</p>
